
Contents
Motors and microcontrollers
Bronze
Worksheet 1 		Basic DC motor control
Worksheet 2		Full bridge motor control
Worksheet 3		Servo motor control
Worksheet 4		Stepper motor control	

Gold
Worksheet 5		DC motor speed control

Teacher’s notes



Preparation
Motors and microcontrollers
Before tackling the worksheets you will need to understand some basic information:
Microcontroller basics
These worksheets assume that you have completed a basic course in microcontroller programming. 
Actuators board wiring diagram
The worksheets make use of the Matrix E-blocks Actuators panel which includes a servo motor, stepper motor and DC motor with feedback. You will need to make sure that you understand how this is connected to the microcontroller port and get an idea of how the circuit works. You can find a full circuit diagram in the E-blocks II Resources section on the Matrix web site. 
The connections on this are as follows:
* Bit 0	Servo
* Bit 1	DC motor A
* Bit 2	DC motor B
* Bit 3	Stepper A
* Bit 4 	Stepper A’
* Bit 5	Stepper B
* Bit 6	Stepper B’
* Bit 7	DC motor feedback
Half and full bridge control
You will need to understand the difference between half and full bridge control of motors. There is plenty of information on this on the internet. 
Stepper motor control
You will need to understand how to drive stepper motors. Again, there is plenty of information on this on the internet.
Servo motor control
You will need to understand how to drive servo motors. Again, there is plenty of information on this on the internet.



Worksheet 1
Simple DC motor control
CP0507-1Motors and microcontrollers
There is a huge number of devices that use small motors including toys, electric toothbrushes, medical and mechatronics systems. Turning them on and off requires the use of a relay or a transistor. Varying the speed requires the use of Pulse Width Modulation as a power control technique.

In this worksheet you will learn how to use a potentiometer and PWM to control the speed of a simple DC motor.


https://youtu.be/e4gB8YcOp8I

Over to you:
* Watch the video “Controlling DC motors – Simple DC” on the Flowcode YouTube site. 
* Load the file “Simple DC". Set up the hardware appropriately. 
* The program allows you to control the speed of the motor using a potentiometer.
Challenge:
* Modify the program so that two switches control the speed of the motor: plus and minus.
* Print the speed on the LCD.
Hints:
1. In the main loop detect if a switch has been pressed – say switch PORTA0 and PORTA1 on a combo board or switch board on port A.
2. Use a variable SPEED and add or subtract 1 from SPEED as the appropriate switch is detected.
3. Use two IF icons for the logic – IF switch A0 is pressed or IF switch A1 is pressed
4. Put the appropriate logic in the YES branch of the IF icons 
5. Replace the two IF icons with a SWITCH icon.

Worksheet 2
Full bridge motor control
CP0507-2
Motors and microcontrollersSometimes we need to control the direction of a motor – for example an electric wheelchair. Wheelchairs typically make use of a pair of 12 or 24V DC motors – one on each drive wheel. A microcontroller /joystick system allows users to go forwards, backwards and also turn left and right. A full bridge circuit – typically in a single chip/module these days - provides this control.

In this worksheet you learn how to control a motor using a full bridge system. 


https://youtu.be/-ajj-YChfro
Over to you:
* Watch the video “Controlling DC motors – full bridge” on the Flowcode YouTube site. 
* Load the file “Full bridge". Set up the hardware appropriately. 
* The program cycles the motor forwards and backwards at a fixed speed.
Challenge:
* Modify the program so that two switches control the direction of the motor: forwards and backwards and two switches control the speed.
* Print speed and the direction on the LCD.
Hints:
1. In the main loop detect if a switch has been pressed – say A0, A1, A2, A3
2. Use a SWITCH icon for the logic – assume only one switch is pressed at any time
3. Put the appropriate logic in the branches of the SWITCH icon.


Worksheet 3
Servo motor control
CP0507-3
Motors and microcontrollers
Small servo motors use a miniature DC motor with positional feedback control to allow you to control the angle of a motor rather than the speed. The angle is changed to a linear position control by using a small arm on the rotor with a rod. This allows the flaps on radio-controlled aeroplanes to be controlled remotely.

In this worksheet you learn how to control simple servo motors.


https://youtu.be/U-GoNwE5kPk
Over to you:
* Watch the video “Controlling Servo motors” on the Flowcode YouTube site. 
* Load the file “Servo". Set up the hardware appropriately. 
* The program uses a potentiometer to adjust the position of the servo motor. 
Challenge:
* Use a logic analyser to view the waveform generated by the microcontroller for different positions of the servo motor.
o Plug the logic analyser onto the header pins near the Port C, where you plugged the motors board into.
* Calibrate the motor angle for 0 and 255 full scale.
* Use some maths to display the angle on the LCD.
Hints:
1. Set up a Real Type variable – Angle.
2. Make sure you use the decimal point on all Real calculations: e.g. “2.0” not “2”.
3. Measure the angle (visually) for an output of 0 and 255.
4. Calculate the angle and display it on the LCD.

Worksheet 4
Stepper motor control
CP0507-4Motors and microcontrollers
Stepper motors are used to accurately rotate a motor one step at a time. These have lots of applications including CNC machines for shaping wood and metal. (The spindle here is often a DC motor with speed control).

In this worksheet you will learn how to control a stepper motor. 


https://youtu.be/8Ihe7q362RA
Over to you:
* Watch the video “Controlling stepper motors” on the Flowcode YouTube site. 
* Load the file “Stepper". Set up the hardware appropriately. 
Challenge:
* Develop a program that cycles the motor forwards or backwards in 10 degree steps when a forward or backward switch is pressed.
Hints:
1. Use the Actuators board datasheet to understand how many steps are in a 360 degree circle.
2. In the main loop detect if a +10 degree or -10 degree switch has been pressed – say switch PORTA0 and PORTA1 on a combo board.
3. Use a SWITCH icon for the logic and a LOOP inside each branch that moves the motor forwards or backwards by the appropriate step count. 
4. Use the display to show the program function.




Worksheet 5
DC motor speed control
CP0507-5Motors and microcontrollers
Varying the power varies the speed, but that does not tell you how fast the motor is turning. For a DC motor some kind of feedback is needed. Then you can form a ‘closed loop’ system with a microcontroller: the microcontroller measures the speed and varies the power until the required speed of the motor is reached. This technique is used in all sorts of machines.

In this worksheet you learn how to make a system that will allow you to measure and then control motor speed.


https://youtu.be/-hRHCYSXBSE
The DC motor rotor on the Actuators panel is fitted with a 3 vein plastic disc and opto sensor. It creates pulses on the microcontroller input as the motor rotates. The technique of measuring speed involves measuring the time of the pulses from the opto sensor. This involves using a pin interrupt. Interrupts are complex because they can upset the other parts of the program if they are not handled carefully. 
So this is quite an advanced exercise.
Over to you:
* Watch the video “Controlling DC motors – speed control” on the Flowcode YouTube site. 
* Load the program “Feedback control” into your hardware. Set up the hardware as detailed in the program and compile your program to the microcontroller.
Challenge:
* Use the logic analyser to understand the function of the program. 
* Modify the program to form a closed loop system that varies the speed of the DC motor. Use two push to make switches to increase and decrease the speed.
Hints:
1. The program you have measures the speed in RPM.
2. In the Main loop detect which switches are pressed – if any.
3. Create a variable TARGET_RPM
4. Change the display so that TARGET_RPM and RPM speed are displayed. Use the update-display routine for writing to the display.
5. Vary the DC motor power up or down depending on whether the TARGET_RPM is lower or greater than the RPM.


Teacher’s notes
Motors and microcontrollersPrevious learning
Some understanding of electronics is needed. 
Pedagogy
This set of worksheets provides structure for the study of microcontroller programming. The worksheets provide structure to the learning but do not provide all the information students need. Our vision as to how you teach this subject is:
1. This is a very practical subject. We expect that 90% of the time students spend on this module will be spent working alone. 
2. Each student should have Flowcode Embedded software and a set of E-blocks 3 hardware. Don’t be tempted to try to get students to learn this subject in pairs.
3. Students should be introduced to each topic or worksheet. They should be given time to investigate the topic using the internet. If students are investigating this on their own, you may want to give additional structure to this activity.
4. Students should then load an example program and download this to the microcontroller so that they can see how the program works. Example programs are available on the Flowcode Wiki for each of PIC, Arduino Mega and ESP32 microcontrollers. 
5. Students should be given the opportunity to watch the accompanying YouTube video – individually or as a class activity. This explains the program.
6. Students then modify each example as detailed in the worksheet. This ensures that they have success, but also ensures that they have understanding.
7. Occasionally you should test students understanding by asking them to complete a project from scratch. This tests their understanding of what they have learned. 
8. Students do not have to do all worksheets or tasks. That’s up to you to decide. Worksheet 10 and 11 are quite advanced.
9. There are three sets of worksheets in this series: Introduction to microcontrollers, Sensors and microcontrollers, and Motors and microcontrollers. We have split the content by topic for ease of publication. You will need to decide what sequence your students complete the worksheets in. We have split the worksheet difficulty into Bronze, Silver and Gold. Not all students will be able to complete all exercises. A reasonable approach would be to deliver Bronze in each of Introduction to microcontrollers, Sensors and microcontrollers, and Motors and microcontrollers, then deliver Silver then deliver Gold to those students who are capable.
10. The curriculum is based on the requirements of the BTEC level 3 in Engineering – Unit 6: Microcontroller systems for engineers.  This can be downloaded from the Pearson web site. 
Example programs
In general the worksheets make use of prewritten functional examples. Students load the example, understand it and then modify it to make sure that they have learned  the principles under discussion. 

The examples are available directly from within the Flowcode package. From within Flowcode select: FILE…NEW PROJECT…OPEN EXAMPLE OR TEMPLATE…and select the example you want from the relevant worksheet pack. 

Examples are available separately for PIC, Arduino and Arduino microcontrollers. 
Time
Of course this depends on student capability. We estimate that it will take 7 hours to complete all the worksheets in this module. 
Software
The videos make use of Flowcode embedded and we anticipate that you are likely to use this for your programs. But you can use these worksheets with any microcontroller development software. The flowchart programs can easily be followed by C programmers. 
Assessment
Creating programs from scratch will be suitable as a way of assessing that students have understood the programs and have programming ability. 
Hardware



This course is designed to be used with a Matrix Microcontroller development centre. There are three versions:
BL5394		ESP32 microcontroller development centre
BL8624		PIC microcontroller development centre
BL3797		Arduino microcontroller development centre
These consist of:
Upstream board – BL0082 PIC, BL0040 Arduino, or BL0070 ESP32
BL0114 Combo board
BL0117 Prototype board
BL0118 Project board
BL0127 Actuators board
BL0135 9 axis motion / accelerometer board
BL0144 Temp/humidity board
BL0145 Switch board
BL0156 Splitter board
BL0172 Logic analyser with ribbon cable
BL0167 LED board
BL0183 Relay board
BL0189 Analogue board


Version control
Motors and microcontrollers12 11 25	First beta
2


